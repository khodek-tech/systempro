# SYSTEM.PRO - Shifts Module Specification
# Modul pro plánování a přehled směn zaměstnanců

module:
  id: shifts
  name: Směny
  description: Plánování a přehled směn zaměstnanců
  component: ShiftsModule
  store: useShiftsStore
  icon: Calendar

access:
  roles:
    - role-1  # Prodavač (vlastní směny)
    - role-3  # Skladník (vlastní směny)
    - role-5  # Obsluha e-shopu (vlastní směny)
    - role-6  # Obchodník (vlastní směny)

  viewMappings:
    - viewerRoleId: role-7  # Vedoucí velkoobchodu
      visibleRoleIds: [role-1, role-6]  # Prodavači a Obchodníci
    - viewerRoleId: role-8  # Majitel
      visibleRoleIds: [role-1, role-3, role-4, role-5, role-6, role-7]

  note: >
    Základní role vidí pouze vlastní směny.
    Vedoucí a Majitel mohou přepínat mezi zaměstnanci/prodejnami.

data_model:
  employeeWorkingHours:
    alternating: boolean  # true = střídání lichý/sudý týden
    oddWeek: StoreOpeningHours  # Rozvrh pro lichý týden (nebo jediný rozvrh)
    evenWeek?: StoreOpeningHours  # Rozvrh pro sudý týden (jen pokud alternating=true)

  shiftsState:
    shiftsViewMode: card | view
    selectedStoreId: string | null
    selectedMonth: number  # 0-11
    selectedYear: number

  shiftDay:
    date: Date
    dayOfWeek: number  # 0=Ne, 1=Po, ..., 6=So
    isWorkDay: boolean  # pracuje uživatel tento den
    isOddWeek: boolean  # je lichý ISO týden
    openingHours?: DayOpeningHours  # pracovní doba

  dayOpeningHours:
    open: string  # HH:MM
    close: string  # HH:MM
    closed: boolean

features:
  - id: calendar_view
    name: Kalendářní zobrazení
    description: Měsíční přehled směn
    acceptance_criteria:
      - Zobrazení celého měsíce
      - Barevné rozlišení pracovních dnů
      - Možnost navigace mezi měsíci
      - Zobrazení pracovní doby pro pracovní dny
      - Pokud workingHours není nastavena, zobrazí se "Pracovní doba není nastavena"

  - id: odd_even_weeks
    name: Lichý/sudý týden
    description: Volitelné střídání lichých a sudých týdnů
    acceptance_criteria:
      - Střídání dle ISO week čísla (lichý/sudý)
      - Zapíná se přes alternating flag v EmployeeWorkingHours
      - Lichý týden = oddWeek rozvrh, sudý = evenWeek rozvrh
      - Badges "Lichý"/"Sudý" jen pokud alternating=true
      - Bez alternating se používá oddWeek jako jediný rozvrh

  - id: store_selection
    name: Výběr prodejny
    description: Filtrování zaměstnanců podle prodejny (pro adminy/vedoucí)
    acceptance_criteria:
      - Pouze pro uživatele s viewMappings
      - Výběr prodejny filtruje zaměstnance dané prodejny
      - Pokud jen vlastní směny, výběr není dostupný
      - Prodejna se nepoužívá pro určení hodin (vždy z user.workingHours)

  - id: employee_working_hours
    name: Pracovní doba zaměstnance
    description: Každý zaměstnanec má vlastní pracovní dobu
    acceptance_criteria:
      - Vždy se používá user.workingHours (žádný fallback na prodejnu)
      - Může být sameAllWeek nebo per den
      - Se střídáním: oddWeek pro lichý týden, evenWeek pro sudý
      - Bez střídání: oddWeek jako jediný rozvrh
      - Zdroj pracovní doby vždy "Vlastní"

  - id: copy_from_store
    name: Kopírovat z prodejny
    description: Předvyplnění pracovní doby z otevírací doby prodejny
    acceptance_criteria:
      - Tlačítko dostupné jen pokud zaměstnanec má přiřazené prodejny
      - Kopíruje otevírací dobu prodejny do vybraného týdne (lichý/sudý)
      - Slouží jako pohodlná předvolba, admin může dále upravit

notifications:
  badge:
    type: none
    description: Modul nemá badge notifikace

scenarios:
  - id: SHIFT-001
    name: Zobrazení vlastních směn
    preconditions:
      - Uživatel je přihlášen
      - Má nastavenou pracovní dobu (workingHours)
    steps:
      - Otevřu modul Směny
      - Vidím kalendář aktuálního měsíce
      - Pracovní dny jsou zvýrazněny zeleně
      - Vidím pracovní dobu pro každý pracovní den
    expected:
      - Zobrazují se pouze moje směny
      - Zdroj pracovní doby: "Vlastní"

  - id: SHIFT-002
    name: Navigace mezi měsíci
    preconditions:
      - Modul Směny je otevřen
    steps:
      - Vidím aktuální měsíc (např. Leden 2026)
      - Kliknu šipku doprava
      - Zobrazí se Únor 2026
      - Kliknu šipku doleva dvakrát
      - Zobrazí se Prosinec 2025
    expected:
      - Plynulá navigace mezi měsíci
      - Přechod přes roky funguje

  - id: SHIFT-003
    name: Střídání lichý/sudý týden
    preconditions:
      - Zaměstnanec má alternating=true
      - oddWeek a evenWeek mají různé rozvrhy
    steps:
      - Otevřu směny pro lichý ISO týden
      - Vidím pracovní dny dle oddWeek rozvrhu
      - Přejdu na sudý ISO týden
      - Vidím pracovní dny dle evenWeek rozvrhu
      - Vidím badge "Lichý" resp. "Sudý"
    expected:
      - Lichý ISO týden používá oddWeek
      - Sudý ISO týden používá evenWeek
      - Badges se zobrazují jen při alternating

  - id: SHIFT-004
    name: Vedoucí vidí směny podřízených
    preconditions:
      - Uživatel je Vedoucí velkoobchodu (role-7)
      - Existují Prodavači na různých prodejnách
    steps:
      - Otevřu modul Směny
      - Vidím výběr prodejny
      - Vyberu prodejnu
      - Zobrazí se zaměstnanci dané prodejny
    expected:
      - Vedoucí vidí všechny podřízené
      - Filtrování podle prodejny funguje

  - id: SHIFT-005
    name: Zaměstnanec bez střídání (skladník)
    preconditions:
      - Zaměstnanec má alternating=false
      - oddWeek: Po-Pá 08:00-16:30, So+Ne volno
    steps:
      - Otevřu modul Směny
      - Vidím směny dle oddWeek rozvrhu
      - Žádné badges "Lichý"/"Sudý"
    expected:
      - Směny podle oddWeek (jediný rozvrh)
      - Bez rozlišení lichý/sudý

  - id: SHIFT-006
    name: Zaměstnanec bez pracovní doby
    preconditions:
      - Zaměstnanec nemá nastavenou workingHours
    steps:
      - Otevřu modul Směny
    expected:
      - Zobrazí se zpráva "Pracovní doba není nastavena"
      - Žádný kalendář

  - id: SHIFT-007
    name: Kopírování pracovní doby z prodejny
    preconditions:
      - Zaměstnanec má přiřazenu prodejnu s definovanou otevírací dobou
      - Formulář úpravy zaměstnance je otevřen
    steps:
      - Zapnu pracovní dobu
      - Kliknu "Kopírovat z prodejny"
      - Pracovní doba se předvyplní dle otevírací doby prodejny
      - Upravím dle potřeby
    expected:
      - Otevírací doba prodejny se zkopíruje do vybraného týdne
      - Admin může dále upravit

edge_cases:
  - id: SHIFT-E001
    name: Prodejna bez otevírací doby
    description: Prodejna nemá definované openingHours
    expected: >
      Tlačítko "Kopírovat z prodejny" se nezobrazí.
      Pracovní doba zaměstnance se musí nastavit ručně.

  - id: SHIFT-E002
    name: Zaměstnanec bez prodejny
    description: Zaměstnanec nemá přiřazenou prodejnu (skladník)
    expected: >
      Pracovní doba se bere výhradně z user.workingHours.
      Tlačítko "Kopírovat z prodejny" se nezobrazí.

  - id: SHIFT-E003
    name: Více prodejen přiřazených uživateli
    description: Uživatel má více prodejen v storeIds
    expected: >
      Kopírování z prodejny použije první prodejnu (storeIds[0]).
      Výběr prodejny v kalendáři slouží jen jako filtr zaměstnanců.

  - id: SHIFT-E004
    name: Přechod roku (prosinec/leden)
    description: Navigace z prosince do ledna dalšího roku
    expected: >
      Rok se automaticky aktualizuje.
      ISO týdny pokračují korektně přes hranici roku.

  - id: SHIFT-E005
    name: Zapnutí/vypnutí střídání
    description: Admin zapíná/vypíná alternating v nastavení zaměstnance
    expected: >
      Při zapnutí se oddWeek převede na per-day mód a vytvoří se prázdný evenWeek.
      Při vypnutí se zachová oddWeek, evenWeek se zahodí.
